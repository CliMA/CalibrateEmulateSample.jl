<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sinusoid Example · CalibrateEmulateSample.jl</title><meta name="title" content="Sinusoid Example · CalibrateEmulateSample.jl"/><meta property="og:title" content="Sinusoid Example · CalibrateEmulateSample.jl"/><meta property="twitter:title" content="Sinusoid Example · CalibrateEmulateSample.jl"/><meta name="description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="og:description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="twitter:description" content="Documentation for CalibrateEmulateSample.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CalibrateEmulateSample.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CalibrateEmulateSample.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../calibrate/">Calibrate</a></li><li><a class="tocitem" href="../../emulate/">Emulate</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Emulator testing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../emulators/regression_2d_2d/">Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a></li><li><a class="tocitem" href="../emulators/lorenz_integrator_3d_3d/">Integrating Lorenz 63 with an emulated integrator</a></li><li><a class="tocitem" href="../emulators/ishigami_3d_1d/">Global Sensitiviy Analysis for an emulated Ishigami function</a></li></ul></li><li><a class="tocitem" href="../lorenz_example/">Lorenz example</a></li><li><a class="tocitem" href="../edmf_example/">Turbulence example</a></li></ul></li><li><a class="tocitem" href="../../GaussianProcessEmulator/">Gaussian Process</a></li><li><a class="tocitem" href="../../random_feature_emulator/">Random Features</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Package Design</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../API/AbstractMCMC/">AbstractMCMC sampling API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1" type="checkbox"/><label class="tocitem" for="menuitem-10-1"><span class="docs-label">CalibrateEmulateSample</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1-1" type="checkbox"/><label class="tocitem" for="menuitem-10-1-1"><span class="docs-label">Emulators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../API/Emulators/">General Interface</a></li><li><a class="tocitem" href="../../API/GaussianProcess/">Gaussian Process</a></li><li><a class="tocitem" href="../../API/RandomFeatures/">Random Features</a></li></ul></li><li><a class="tocitem" href="../../API/MarkovChainMonteCarlo/">MarkovChainMonteCarlo</a></li><li><a class="tocitem" href="../../API/Utilities/">Utilities</a></li></ul></li></ul></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Sinusoid Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sinusoid Example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/main/docs/src/examples/sinusoid_example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Sinusoid-Example"><a class="docs-heading-anchor" href="#Sinusoid-Example">Sinusoid Example</a><a id="Sinusoid-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Sinusoid-Example" title="Permalink"></a></h1><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>This example demonstrates how to use CalibrateEmulateSample.jl for a simple model that generates noisy observables of a signal. The sinusoid signal is defined by two parameters: its shift along an axis and its amplitude. We make noisy observations of the signal and we can calculate the mean of the signal, which is informative about its shift along the axis, and the range of the signal, which is informative  about the amplitude. We show how we can carry out uncertainty quantification on our parameter values, given  some observations and a model of this problem.</p><h3 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h3><p>We have a model of a sinusoidal signal that is a function of parameters <span>$\theta=(A,v)$</span>, where <span>$A$</span> is the amplitude of the signal, <span>$v$</span> is vertical shift of the signal:  <span>$f(A, v) = A \sin(\phi + t) + v, \forall t \in [0,2\pi]$</span> Here, <span>$\phi$</span> is the random phase of each signal.  The goal is to estimate the parameters <span>$\theta=(A,v)$</span>, and our uncertainty about them, given some noisy observations. We will use the range and mean of a signal as our observable - inverse problem described here</p><h1 id="Walkthrough-of-code"><a class="docs-heading-anchor" href="#Walkthrough-of-code">Walkthrough of code</a><a id="Walkthrough-of-code-1"></a><a class="docs-heading-anchor-permalink" href="#Walkthrough-of-code" title="Permalink"></a></h1><h2 id="Set-up"><a class="docs-heading-anchor" href="#Set-up">Set up</a><a id="Set-up-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up" title="Permalink"></a></h2><p>First, we load the packages we need:</p><pre><code class="nohighlight hljs">using LinearAlgebra, Random

using Distributions, Plots
using JLD2

# CES
using CalibrateEmulateSample

const EKP = CalibrateEmulateSample.EnsembleKalmanProcesses
const PD = EKP.ParameterDistributions</code></pre><p>Define a model which generates a sinusoid given parameters <span>$\theta$</span>: an amplitude and a vertical shift. We will estimate these parameters from data. The model adds a random phase shift upon evaluation.</p><pre><code class="nohighlight hljs"># Seed for pseudo-random number generator.
rng_seed = 41
rng = Random.MersenneTwister(rng_seed)
# Define x-axis
dt = 0.01
trange = 0:dt:(2 * pi + dt)

function model(amplitude, vert_shift)
    phi = 2 * pi * rand(rng)
    return amplitude * sin.(trange .+ phi) .+ vert_shift
end
</code></pre><p>We will define a &quot;true&quot; amplitude and vertical shift, to generate some pseudo-observations.  Usually our observations are not perfectly noise-free, so we add some white noise to our observations. We plot the &quot;true&quot; underlying signal and the observed noisy signal below.</p><pre><code class="nohighlight hljs">amplitude_true = 3.0
vert_shift_true = 7.0
signal_true = model(amplitude_true, vert_shift_true)
white_noise = MvNormal(zeros(length(signal_true)), 1.0)
signal_observed = signal_true .+ rand(white_noise)
print(signal_true)
p = plot(signal_true, color=:black, linewidth=3, label=&quot;True signal&quot;)
plot!(signal_observed, color=:red, label=&quot;Observed signal&quot;)
savefig(p, joinpath(data_save_directory, &quot;true_vs_observed_signal.png&quot;))</code></pre><p>ADD PLOT HERE</p><p>We then define <span>$G(\theta)$</span>, which returns the observables of the sinusoid given a parameter vector. These observables should be defined such that they are informative about the parameters we wish to estimate. Here, the two observables are the <span>$y$</span> range of the curve (which is informative about its amplitude), as well as its mean (which is informative about its vertical shift).</p><pre><code class="nohighlight hljs">function G(u)
    amplitude, vert_shift = u
    sincurve = model(amplitude, vert_shift)
    return [maximum(sincurve) - minimum(sincurve), mean(sincurve)]
end

# Our input parameters are 2d and our outputs are 2d
theta_true = [amplitude_true, vert_shift_true]
dim_params = 2
dim_output = 2

# Define the range and mean of our psuedo-observations, ``y``
white_noise = MvNormal(zeros(dim_output), 0.2)
y = G(theta_true) .+ rand(white_noise)
print(y)</code></pre><h2 id="Calibrate"><a class="docs-heading-anchor" href="#Calibrate">Calibrate</a><a id="Calibrate-1"></a><a class="docs-heading-anchor-permalink" href="#Calibrate" title="Permalink"></a></h2><p>For the calibration step, we need to solve the inverse problem. We define prior distributions on the two parameters. For the amplitude, we define a prior with mean 2 and standard deviation 1. It is additionally constrained to be nonnegative. For the vertical shift we define a Gaussian prior with mean 0 and standard deviation 5.</p><pre><code class="nohighlight hljs">prior_u1 = PD.constrained_gaussian(&quot;amplitude&quot;, 2, 1, 0, Inf)
prior_u2 = PD.constrained_gaussian(&quot;vert_shift&quot;, 0, 5, -Inf, Inf)
prior = PD.combine_distributions([prior_u1, prior_u2])
# Plot priors
p = plot(prior)
savefig(p, joinpath(data_save_directory, &quot;prior.png&quot;))</code></pre><p>Add plot</p><p>We now generate the initial ensemble and set up the ensemble Kalman inversion.</p><pre><code class="nohighlight hljs">N_ensemble = 10
N_iterations = 5

initial_ensemble = EKP.construct_initial_ensemble(rng, prior, N_ensemble)

ensemble_kalman_process = EKP.EnsembleKalmanProcess(initial_ensemble, y, Γ, EKP.Inversion(); rng = rng)</code></pre><p>We are now ready to carry out the inversion. At each iteration, we get the ensemble from the last iteration, apply <span>$G(\theta)$</span> to each ensemble member, and apply the Kalman update to the ensemble.</p><pre><code class="nohighlight hljs">for i in 1:N_iterations
    params_i = EKP.get_ϕ_final(prior, ensemble_kalman_process)

    G_ens = hcat([G(params_i[:, i]) for i in 1:N_ensemble]...)

    EKP.update_ensemble!(ensemble_kalman_process, G_ens)
end</code></pre><p>Finally, we get the ensemble after the last iteration. This provides our estimate of the parameters.</p><pre><code class="nohighlight hljs">final_ensemble = EKP.get_ϕ_final(prior, ensemble_kalman_process)</code></pre><p>Plot this.(would be nice to have an animation)</p><pre><code class="nohighlight hljs">data_save_directory = joinpath(example_directory, &quot;output&quot;)
</code></pre><h2 id="Emulate"><a class="docs-heading-anchor" href="#Emulate">Emulate</a><a id="Emulate-1"></a><a class="docs-heading-anchor-permalink" href="#Emulate" title="Permalink"></a></h2><h2 id="Sample"><a class="docs-heading-anchor" href="#Sample">Sample</a><a id="Sample-1"></a><a class="docs-heading-anchor-permalink" href="#Sample" title="Permalink"></a></h2></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Wednesday 6 December 2023 22:10">Wednesday 6 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Regression of mathbbR^2 to mathbbR^2 smooth function · CalibrateEmulateSample.jl</title><meta name="title" content="Regression of mathbbR^2 to mathbbR^2 smooth function · CalibrateEmulateSample.jl"/><meta property="og:title" content="Regression of mathbbR^2 to mathbbR^2 smooth function · CalibrateEmulateSample.jl"/><meta property="twitter:title" content="Regression of mathbbR^2 to mathbbR^2 smooth function · CalibrateEmulateSample.jl"/><meta name="description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="og:description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="twitter:description" content="Documentation for CalibrateEmulateSample.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="CalibrateEmulateSample.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">CalibrateEmulateSample.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../../contributing/">Contributing</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../sinusoid_example/">Simple example walkthrough</a></li><li><a class="tocitem" href="../../lorenz_example/">Lorenz example</a></li><li><a class="tocitem" href="../../edmf_example/">Turbulence example</a></li><li><a class="tocitem" href="../../Cloudy_example/">Cloudy example</a></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Emulator testing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a><ul class="internal"><li><a class="tocitem" href="#Walkthrough-of-the-code"><span>Walkthrough of the code</span></a></li><li><a class="tocitem" href="#Validation-and-Plots"><span>Validation and Plots</span></a></li></ul></li><li><a class="tocitem" href="../lorenz_integrator_3d_3d/">Integrating Lorenz 63 with an emulated integrator</a></li><li><a class="tocitem" href="../global_sens_analysis/">Global Sensitiviy Analysis (GSA) test functions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../calibrate/">Calibrate</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Emulate</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../emulate/">Emulator</a></li><li><a class="tocitem" href="../../../GaussianProcessEmulator/">Gaussian Process</a></li><li><a class="tocitem" href="../../../random_feature_emulator/">Random Features</a></li></ul></li><li><a class="tocitem" href="../../../sample/">Sample</a></li><li><a class="tocitem" href="../../../glossary/">Glossary</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-1" type="checkbox"/><label class="tocitem" for="menuitem-9-1"><span class="docs-label">CalibrateEmulateSample</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-9-1-1" type="checkbox"/><label class="tocitem" for="menuitem-9-1-1"><span class="docs-label">Emulators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../API/Emulators/">General Interface</a></li><li><a class="tocitem" href="../../../API/GaussianProcess/">Gaussian Process</a></li><li><a class="tocitem" href="../../../API/RandomFeatures/">Random Features</a></li></ul></li><li><a class="tocitem" href="../../../API/MarkovChainMonteCarlo/">MarkovChainMonteCarlo</a></li><li><a class="tocitem" href="../../../API/Utilities/">Utilities</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Emulator testing</a></li><li class="is-active"><a href>Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/main/docs/src/examples/emulators/regression_2d_2d.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Regression-of-\\mathbb{R}2-\\to-\\mathbb{R}2-smooth-function"><a class="docs-heading-anchor" href="#Regression-of-\\mathbb{R}2-\\to-\\mathbb{R}2-smooth-function">Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a><a id="Regression-of-\\mathbb{R}2-\\to-\\mathbb{R}2-smooth-function-1"></a><a class="docs-heading-anchor-permalink" href="#Regression-of-\\mathbb{R}2-\\to-\\mathbb{R}2-smooth-function" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">How do I run this code?</header><div class="admonition-body"><p>The full code is found in the <a href="https://github.com/CliMA/CalibrateEmulateSample.jl/tree/main/examples/Emulator"><code>examples/Emulator/</code></a> directory of the github repository</p></div></div><p>In this example, we assess directly the performance of our machine learning emulators. The task is to learn the function:</p><p class="math-container">\[G\colon [0,2\pi]^2 \to \mathbb{R}^2, G(x_1,x_2) = (\sin(x_1) + \cos(x_2), \sin(x_1) - \cos(x_2)) \]</p><p>observed at 150 points, subject to additive (and possibly correlated) Gaussian noise <span>$N(0,\Sigma)$</span>.</p><p>We have several different emulator configurations in this example that the user can play around with. The goal of this example is to predict the function (i.e. posterior mean) and uncertainty (i.e posterior pointwise variance) on a <span>$200\times200$</span> grid providing a mean square error between emulated and true function and  with <code>plot_flag = true</code> we also save several plots.</p><p>We will term scalar-output Gaussin process emulator as &quot;GP&quot;, scalar-output random feature emulator as &quot;scalar RF&quot;, and vector-output random feature emulator as &quot;vector RF&quot; henceforth.</p><h2 id="Walkthrough-of-the-code"><a class="docs-heading-anchor" href="#Walkthrough-of-the-code">Walkthrough of the code</a><a id="Walkthrough-of-the-code-1"></a><a class="docs-heading-anchor-permalink" href="#Walkthrough-of-the-code" title="Permalink"></a></h2><p>We first import some standard packages</p><pre><code class="language-julia hljs">using Random
using StableRNGs
using Distributions
using Statistics
using LinearAlgebra</code></pre><p>and relevant CES packages needed to define the emulators, packages and kernel structures</p><pre><code class="language-julia hljs">using CalibrateEmulateSample.Emulators
# Contains `Emulator`, `GaussianProcess`, `ScalarRandomFeatureInterface`, `VectorRandomFeatureInterface`
# `GPJL`, `SKLJL`, `SeparablKernel`, `NonSeparableKernel`, `OneDimFactor`, `LowRankFactor`, `DiagonalFactor`
using CalibrateEmulateSample.DataContainers # Contains `PairedDataContainer`</code></pre><p>To play with the hyperparameter optimization of RF, the optimizer options sometimes require <code>EnsembleKalmanProcesses.jl</code> structures, so we load this too</p><pre><code class="language-julia hljs">using CalibrateEmulateSample.EnsembleKalmanProcesses # Contains `DataMisfitController`</code></pre><p>We have 9 cases that the user can toggle or customize</p><pre><code class="language-julia hljs">cases = [
    &quot;gp-skljl&quot;,
    &quot;gp-gpjl&quot;, # Very slow prediction...
    &quot;rf-scalar&quot;,
    &quot;rf-svd-diag&quot;,
    &quot;rf-svd-nondiag&quot;,
    &quot;rf-nosvd-diag&quot;,
    &quot;rf-nosvd-nondiag&quot;,
    &quot;rf-svd-nonsep&quot;,
    &quot;rf-nosvd-nonsep&quot;,
]</code></pre><p>The first two are for GP with either <code>ScikitLearn.jl</code> or <code>GaussianProcesses.jl</code> interface. The third is for the scalar RF interface, which most closely follows exactly replacing a GP. The rest are examples of vector RF with different types of data processing, (svd = same processing as scalar RF, nosvd = unprocessed) and different RF kernel structures in the output space of increasing complexity/flexibility (diag = Separable diagonal, nondiag = Separable nondiagonal, nonsep = nonseparable nondiagonal).</p><p>We set up the learning problem specification, defining input and output dimensions, and number of data to train on, and the function <code>g</code> and the perturbed samples <code>y</code> with correlated additive noise</p><pre><code class="language-julia hljs">n = 150  # number of training points
p = 2   # input dim 
d = 2   # output dim
X = 2.0 * π * rand(p, n)
# G(x1, x2)
g1x = sin.(X[1, :]) .+ cos.(X[2, :])
g2x = sin.(X[1, :]) .- cos.(X[2, :])
gx = zeros(2, n)
gx[1, :] = g1x
gx[2, :] = g2x
# Add noise η
μ = zeros(d)
Σ = 0.1 * [[0.8, 0.1] [0.1, 0.5]] # d x d
noise_samples = rand(MvNormal(μ, Σ), n)
# y = G(x) + η
Y = gx .+ noise_samples</code></pre><p>We then enter this in a paired data container, which gives a standard of how the data will be read</p><pre><code class="language-julia hljs">iopairs = PairedDataContainer(X, Y, data_are_columns = true)</code></pre><p>We define some common settings for all emulators, e.g. the number of random features to use, and some hyperparameter optimizer options</p><pre><code class="language-julia hljs"># common Gaussian feature setup
pred_type = YType()

# common random feature setup
n_features = 150
optimizer_options = Dict(&quot;n_iteration&quot; =&gt; 10, &quot;scheduler&quot; =&gt; DataMisfitController(on_terminate = &quot;continue&quot;))
nugget = 1e-12</code></pre><p>We then build the emulators. An example for GP (<code>gp-skljl</code>)</p><pre><code class="language-julia hljs"># use scikit learn
gppackage = SKLJL()
# build a GP that learns an additional white noise kernel (along with the default RBF kernel)
gaussian_process = GaussianProcess(gppackage, noise_learn = true)
# the data processing normalizes input data, and decorrelates output data with information from Σ
emulator = Emulator(gaussian_process, iopairs, obs_noise_cov = Σ, normalize_inputs = true) </code></pre><p>An example for scalar RF (<code>rf-scalar</code>)</p><pre><code class="language-julia hljs"># build a scalar RF with a rank-2 kernel in input space (placeholder 1D kernel in output space) and use the optimizer options during training
srfi = ScalarRandomFeatureInterface(
    n_features, 
    p, 
    kernel_structure = SeparableKernel(LowRankFactor(2, nugget), OneDimFactor()), 
    optimizer_options = optimizer_options,
)
# the data processing normalizes input data, and decorrelates output data with information from Σ
emulator = Emulator(srfi, iopairs, obs_noise_cov = Σ, normalize_inputs = true)</code></pre><p>An example for vector RF (<code>rf-nosvd-nonsep</code>)</p><pre><code class="language-julia hljs"># build a vector RF with a rank-4 nonseparable kernel and use the optimizer options during training
vrfi = VectorRandomFeatureInterface(
    n_features,
    p,
    d, # additionally provide the output dimensions size
    kernel_structure = NonseparableKernel(LowRankFactor(4, nugget)),
    optimizer_options = optimizer_options,
)
# the data processing normalizes input data, and does not decorrelate outputs
emulator = Emulator(vrfi, iopairs, obs_noise_cov = Σ, normalize_inputs = true, decorrelate = false)</code></pre><p>For RF and some GP packages, the training occurs during construction of the <code>Emulator</code>, however sometimes one must call an optimize step afterwards</p><pre><code class="nohighlight hljs">optimize_hyperparameters!(emulator)</code></pre><h2 id="Validation-and-Plots"><a class="docs-heading-anchor" href="#Validation-and-Plots">Validation and Plots</a><a id="Validation-and-Plots-1"></a><a class="docs-heading-anchor-permalink" href="#Validation-and-Plots" title="Permalink"></a></h2><p>We create an evaluation grid for our models, in the right shape:</p><pre><code class="language-julia hljs">n_pts = 200
x1 = range(0.0, stop = 2 * π, length = n_pts)
x2 = range(0.0, stop = 2 * π, length = n_pts)
X1, X2 = meshgrid(x1, x2)
inputs = permutedims(hcat(X1[:], X2[:]), (2, 1))</code></pre><p>We predict using the emulators at the new inputs, and <code>transform_to_real</code> inverts the data processing back to physical values</p><pre><code class="language-julia hljs">em_mean, em_cov = predict(emulator, inputs, transform_to_real = true)</code></pre><p>We then plot the predicted mean and pointwise variances, and calculate the errors from the three highlighted cases:</p><h3 id="Gaussian-Process-Emulator-(Sci-kit-learn:-gp-skljl)"><a class="docs-heading-anchor" href="#Gaussian-Process-Emulator-(Sci-kit-learn:-gp-skljl)">Gaussian Process Emulator (Sci-kit learn: <code>gp-skljl</code>)</a><a id="Gaussian-Process-Emulator-(Sci-kit-learn:-gp-skljl)-1"></a><a class="docs-heading-anchor-permalink" href="#Gaussian-Process-Emulator-(Sci-kit-learn:-gp-skljl)" title="Permalink"></a></h3><pre><code class="nohighlight hljs">L^2 error of mean and latent truth:0.0008042391077774167</code></pre><img src="../../../assets/regression2d2d-gp-skljl_y1_predictions.png" width="600">
<img src="../../../assets/regression2d2d-gp-skljl_y2_predictions.png" width="600"><h3 id="Random-Feature-Emulator-(rf-scalar)"><a class="docs-heading-anchor" href="#Random-Feature-Emulator-(rf-scalar)">Random Feature Emulator (<code>rf-scalar</code>)</a><a id="Random-Feature-Emulator-(rf-scalar)-1"></a><a class="docs-heading-anchor-permalink" href="#Random-Feature-Emulator-(rf-scalar)" title="Permalink"></a></h3><pre><code class="nohighlight hljs">L^2 error of mean and latent truth:0.0012253119679379056</code></pre><img src="../../../assets/regression2d2d-rf-scalar_y1_predictions.png" width="600">
<img src="../../../assets/regression2d2d-rf-scalar_y2_predictions.png" width="600"><h3 id="Random-Feature-Emulator-(vector:-rf-nosvd-nonsep)"><a class="docs-heading-anchor" href="#Random-Feature-Emulator-(vector:-rf-nosvd-nonsep)">Random Feature Emulator (vector: <code>rf-nosvd-nonsep</code>)</a><a id="Random-Feature-Emulator-(vector:-rf-nosvd-nonsep)-1"></a><a class="docs-heading-anchor-permalink" href="#Random-Feature-Emulator-(vector:-rf-nosvd-nonsep)" title="Permalink"></a></h3><pre><code class="nohighlight hljs">L^2 error of mean and latent truth:0.0011094292509180393</code></pre><img src="../../../assets/regression2d2d-rf-nosvd-nonsep_y1_predictions.png" width="600">
<img src="../../../assets/regression2d2d-rf-nosvd-nonsep_y2_predictions.png" width="600"></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../Cloudy_example/">« Cloudy example</a><a class="docs-footer-nextpage" href="../lorenz_integrator_3d_3d/">Integrating Lorenz 63 with an emulated integrator »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 12 June 2025 22:33">Thursday 12 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

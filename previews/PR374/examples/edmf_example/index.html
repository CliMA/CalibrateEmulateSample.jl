<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Turbulence example · CalibrateEmulateSample.jl</title><meta name="title" content="Turbulence example · CalibrateEmulateSample.jl"/><meta property="og:title" content="Turbulence example · CalibrateEmulateSample.jl"/><meta property="twitter:title" content="Turbulence example · CalibrateEmulateSample.jl"/><meta name="description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="og:description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="twitter:description" content="Documentation for CalibrateEmulateSample.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CalibrateEmulateSample.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CalibrateEmulateSample.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../sinusoid_example/">Simple example walkthrough</a></li><li><a class="tocitem" href="../lorenz_example/">Lorenz example</a></li><li class="is-active"><a class="tocitem" href>Turbulence example</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#What-is-being-solved-here"><span>What is being solved here</span></a></li><li><a class="tocitem" href="#Running-the-examples"><span>Running the examples</span></a></li><li><a class="tocitem" href="#Solution-and-output"><span>Solution and output</span></a></li></ul></li><li><a class="tocitem" href="../Cloudy_example/">Cloudy example</a></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Emulator testing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../emulators/regression_2d_2d/">Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a></li><li><a class="tocitem" href="../emulators/lorenz_integrator_3d_3d/">Integrating Lorenz 63 with an emulated integrator</a></li><li><a class="tocitem" href="../emulators/global_sens_analysis/">Global Sensitiviy Analysis (GSA) test functions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../calibrate/">Calibrate</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Emulate</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../emulate/">Emulator</a></li><li><a class="tocitem" href="../../GaussianProcessEmulator/">Gaussian Process</a></li><li><a class="tocitem" href="../../random_feature_emulator/">Random Features</a></li></ul></li><li><a class="tocitem" href="../../sample/">Sample</a></li><li><a class="tocitem" href="../../data_processing/">Data Processing and Dimension reduction</a></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox"/><label class="tocitem" for="menuitem-10"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1" type="checkbox"/><label class="tocitem" for="menuitem-10-1"><span class="docs-label">CalibrateEmulateSample</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1-1" type="checkbox"/><label class="tocitem" for="menuitem-10-1-1"><span class="docs-label">Emulators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../API/Emulators/">General Interface</a></li><li><a class="tocitem" href="../../API/GaussianProcess/">Gaussian Process</a></li><li><a class="tocitem" href="../../API/RandomFeatures/">Random Features</a></li></ul></li><li><a class="tocitem" href="../../API/MarkovChainMonteCarlo/">MarkovChainMonteCarlo</a></li><li><a class="tocitem" href="../../API/Utilities/">Utilities</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Turbulence example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Turbulence example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/main/docs/src/examples/edmf_example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Extended-Eddy-Diffusivity-Mass-Flux-(EDMF)-Scheme"><a class="docs-heading-anchor" href="#Extended-Eddy-Diffusivity-Mass-Flux-(EDMF)-Scheme">Extended Eddy-Diffusivity Mass-Flux (EDMF) Scheme</a><a id="Extended-Eddy-Diffusivity-Mass-Flux-(EDMF)-Scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Extended-Eddy-Diffusivity-Mass-Flux-(EDMF)-Scheme" title="Permalink"></a></h1><div class="admonition is-info"><header class="admonition-header">How do I run this code?</header><div class="admonition-body"><p>The full code is found in the <a href="https://github.com/CliMA/CalibrateEmulateSample.jl/tree/main/examples"><code>examples/</code></a> directory of the github repository</p></div></div><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>The extended EDMF scheme is a unified model of turbulence and convection. More information about the model can be found <a href="https://clima.github.io/TurbulenceConvection.jl/stable/">here</a>. This example builds an emulator of the extended EDMF scheme from input-output pairs obtained during a calibration process, and runs emulator-based MCMC to obtain an estimate of the joint parameter distribution.</p><h2 id="What-is-being-solved-here"><a class="docs-heading-anchor" href="#What-is-being-solved-here">What is being solved here</a><a id="What-is-being-solved-here-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-being-solved-here" title="Permalink"></a></h2><p>This example reads calibration data containing input-output pairs obtained during calibration of the EDMF scheme. The calibration is performed using ensemble Kalman inversion, an ensemble-based algorithm that updates the location of the input parameters from the prior to the posterior, thus ensuring an optimal placement of the data used to train the emulator. In this example, the input is formed by either two or five EDMF parameters, and the output is the time-averaged liquid water path (LWP) at 40 locations in the eastern Pacific Ocean. The calibration data also contains the prior distribution of EDMF parameters and the variance of the observed variables (LWP in this case), which is used as a proxy for the magnitude of observational noise.</p><p>More information about EDMF calibration can be found <a href="https://clima.github.io/CalibrateEDMF.jl/stable/">here</a>. The calibration data is used to train the emulator.</p><h2 id="Running-the-examples"><a class="docs-heading-anchor" href="#Running-the-examples">Running the examples</a><a id="Running-the-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-examples" title="Permalink"></a></h2><p>We have two example scenario data (output from a (C)alibration run) that must be simply unzipped before calibration:</p><pre><code class="nohighlight hljs">ent-det-calibration.zip # two-parameter calibration
ent-det-tked-tkee-stab-calibration.zip # five-parameter calibration</code></pre><p>To perform uncertainty quantification use the file <code>uq_for_EDMF.jl</code>. Set the experiment name, and date (for outputs), e.g.</p><pre><code class="language-julia hljs">exp_name = &quot;ent-det-tked-tkee-stab-calibration&quot; 
date_of_run = Date(year, month, day)</code></pre><p>and call,</p><pre><code class="nohighlight hljs">&gt; julia --project uq_for_EDMF.jl</code></pre><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>These runs take currently take ~1-3 hours to complete with Gaussian process emulator. Random feature training currently requires significant multithreading for performance and takes a similar amount of time.</p></div></div><h2 id="Solution-and-output"><a class="docs-heading-anchor" href="#Solution-and-output">Solution and output</a><a id="Solution-and-output-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-and-output" title="Permalink"></a></h2><p>The solution is the posterior distribution, stored in the file <code>posterior.jld2</code>.</p><p>The posterior is visualized by using <code>plot_posterior.jl</code>, which produces corner-type scatter plots of posterior distribution, which show pairwise correlations. Again, set the <code>exp_name</code> and <code>date_of_run</code> values, then call</p><pre><code class="nohighlight hljs">julia --project plot_posterior.jl</code></pre><p>For example, using Random features for case <code>exp_name = &quot;ent-det-calibration&quot;</code> one obtains</p><img src="../../assets/edmf_nonsep_posterior_2d.png" width="300"><p>and <code>exp_name = &quot;ent-det-tked-tkee-stab-calibration&quot;</code> or one obtains</p><img src="../../assets/edmf_nonsep_posterior_5d.png" width="600"><p>The posterior samples can also be investigated directly. They are stored as a <code>ParameterDistribution</code>-type <code>Samples</code> object. One can load this and extract an array of parameters with:</p><pre><code class="language-julia hljs"># input:
# path to posterior.jld2: posterior_filepath (string)

using CalibrateEmulateSample.ParameterDistribution
posterior = load(posterior_filepath)[&quot;posterior&quot;]
posterior_samples = vcat([get_distribution(posterior)[name] for name in get_name(posterior)]...) # samples are columns</code></pre><p>To transform these samples into physical parameter space use the following:</p><pre><code class="nohighlight hljs">transformed_posterior_samples =
mapslices(x -&gt; transform_unconstrained_to_constrained(posterior, x), posterior_samples, dims = 1)</code></pre><div class="admonition is-info"><header class="admonition-header">Computational vs Physical space</header><div class="admonition-body"><p>The computational <span>$\theta$</span>-space are the parameters on which the algorithms act. Statistics (e.g. mean/covariance) are most meaningful when taken in this space. The physical <span>$\phi$</span>-space is a (nonlinear) transformation of the computational space to apply parameter constraints. To pass parameter values back into the forward model, one must transform them. Full details and examples can be found <a href="https://clima.github.io/EnsembleKalmanProcesses.jl/stable/parameter_distributions/">here</a></p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../lorenz_example/">« Lorenz example</a><a class="docs-footer-nextpage" href="../Cloudy_example/">Cloudy example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 22 August 2025 17:36">Friday 22 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>

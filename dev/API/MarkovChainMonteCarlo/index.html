<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>MarkovChainMonteCarlo · CalibrateEmulateSample.jl</title><meta name="title" content="MarkovChainMonteCarlo · CalibrateEmulateSample.jl"/><meta property="og:title" content="MarkovChainMonteCarlo · CalibrateEmulateSample.jl"/><meta property="twitter:title" content="MarkovChainMonteCarlo · CalibrateEmulateSample.jl"/><meta name="description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="og:description" content="Documentation for CalibrateEmulateSample.jl."/><meta property="twitter:description" content="Documentation for CalibrateEmulateSample.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CalibrateEmulateSample.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CalibrateEmulateSample.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation instructions</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/sinusoid_example/">Simple example walkthrough</a></li><li><a class="tocitem" href="../../examples/lorenz_example/">Lorenz example</a></li><li><a class="tocitem" href="../../examples/edmf_example/">Turbulence example</a></li><li><a class="tocitem" href="../../examples/Cloudy_example/">Cloudy example</a></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Emulator testing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/emulators/regression_2d_2d/">Regression of <span>$\mathbb{R}^2 \to \mathbb{R}^2$</span> smooth function</a></li><li><a class="tocitem" href="../../examples/emulators/lorenz_integrator_3d_3d/">Integrating Lorenz 63 with an emulated integrator</a></li><li><a class="tocitem" href="../../examples/emulators/global_sens_analysis/">Global Sensitiviy Analysis (GSA) test functions</a></li></ul></li></ul></li><li><a class="tocitem" href="../../calibrate/">Calibrate</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Emulate</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../emulate/">Emulator</a></li><li><a class="tocitem" href="../../GaussianProcessEmulator/">Gaussian Process</a></li><li><a class="tocitem" href="../../random_feature_emulator/">Random Features</a></li></ul></li><li><a class="tocitem" href="../../sample/">Sample</a></li><li><a class="tocitem" href="../../data_processing/">Data Processing and Dimension reduction</a></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li><li><input class="collapse-toggle" id="menuitem-10" type="checkbox" checked/><label class="tocitem" for="menuitem-10"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1" type="checkbox" checked/><label class="tocitem" for="menuitem-10-1"><span class="docs-label">CalibrateEmulateSample</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-10-1-1" type="checkbox"/><label class="tocitem" for="menuitem-10-1-1"><span class="docs-label">Emulators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Emulators/">General Interface</a></li><li><a class="tocitem" href="../GaussianProcess/">Gaussian Process</a></li><li><a class="tocitem" href="../RandomFeatures/">Random Features</a></li></ul></li><li class="is-active"><a class="tocitem" href>MarkovChainMonteCarlo</a><ul class="internal"><li><a class="tocitem" href="#Top-level-class-and-methods"><span>Top-level class and methods</span></a></li><li><a class="tocitem" href="#Sampler-algorithms"><span>Sampler algorithms</span></a></li><li><a class="tocitem" href="#Emulated-posterior-(Model)"><span>Emulated posterior (Model)</span></a></li><li><a class="tocitem" href="#Internals-MCMC-State"><span>Internals - MCMC State</span></a></li></ul></li><li><a class="tocitem" href="../Utilities/">Utilities</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API</a></li><li><a class="is-disabled">CalibrateEmulateSample</a></li><li class="is-active"><a href>MarkovChainMonteCarlo</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>MarkovChainMonteCarlo</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/main/docs/src/API/MarkovChainMonteCarlo.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MarkovChainMonteCarlo"><a class="docs-heading-anchor" href="#MarkovChainMonteCarlo">MarkovChainMonteCarlo</a><a id="MarkovChainMonteCarlo-1"></a><a class="docs-heading-anchor-permalink" href="#MarkovChainMonteCarlo" title="Permalink"></a></h1><h2 id="Top-level-class-and-methods"><a class="docs-heading-anchor" href="#Top-level-class-and-methods">Top-level class and methods</a><a id="Top-level-class-and-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Top-level-class-and-methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct MCMCWrapper{AVV&lt;:(AbstractVector), AV&lt;:(AbstractVector)}</code></pre><p>Top-level class holding all configuration information needed for MCMC sampling: the prior,  emulated likelihood and sampling algorithm (<code>DensityModel</code> and <code>Sampler</code>, respectively, in  AbstractMCMC&#39;s terminology).</p><p><strong>Fields</strong></p><ul><li><p><code>prior::EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution</code>: <a href="https://clima.github.io/EnsembleKalmanProcesses.jl/dev/parameter_distributions/"><code>ParameterDistribution</code></a> object describing the prior distribution on parameter values.</p></li><li><p><code>observations::AbstractVector</code>: [output<em>dim x N</em>samples] matrix, of given observation data.</p></li><li><p><code>encoded_observations::AbstractVector</code>: Vector of observations describing the data samples to actually used during MCMC sampling (that have been transformed into a space consistent with emulator outputs).</p></li><li><p><code>log_posterior_map::AbstractMCMC.AbstractModel</code>: <code>AdvancedMH.DensityModel</code> object, used to evaluate the posterior density being sampled from.</p></li><li><p><code>mh_proposal_sampler::AbstractMCMC.AbstractSampler</code>: Object describing a MCMC sampling algorithm and its settings.</p></li><li><p><code>sample_kwargs::NamedTuple</code>: NamedTuple of other arguments to be passed to <code>AbstractMCMC.sample()</code>.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L488">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper-Union{Tuple{AMorAV}, Tuple{AV}, Tuple{CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol, AMorAV, EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution, CalibrateEmulateSample.Emulators.Emulator}} where {AV&lt;:(AbstractVector), AMorAV&lt;:Union{AbstractMatrix, AbstractVector}}" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper-Union{Tuple{AMorAV}, Tuple{AV}, Tuple{CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol, AMorAV, EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution, CalibrateEmulateSample.Emulators.Emulator}} where {AV&lt;:(AbstractVector), AMorAV&lt;:Union{AbstractMatrix, AbstractVector}}"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MCMCWrapper(
    mcmc_alg::CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol,
    observation::Union{AbstractMatrix, AbstractVector},
    prior::EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution,
    em::CalibrateEmulateSample.Emulators.Emulator;
    init_params,
    burnin,
    kwargs...
)
</code></pre><p>Constructor for <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper"><code>MCMCWrapper</code></a> which performs the same standardization (SVD  decorrelation) that was applied in the Emulator. It creates and wraps an instance of  <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.EmulatorPosteriorModel"><code>EmulatorPosteriorModel</code></a>, for sampling from the Emulator, and  <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MetropolisHastingsSampler"><code>MetropolisHastingsSampler</code></a>, for generating the MC proposals.</p><ul><li><p><code>mcmc_alg</code>: <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol"><code>MCMCProtocol</code></a> describing the MCMC sampling algorithm to use. Currently implemented algorithms are:</p><ul><li><a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.RWMHSampling"><code>RWMHSampling</code></a>: Metropolis-Hastings sampling from a vanilla random walk with fixed stepsize.</li><li><a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.pCNMHSampling"><code>pCNMHSampling</code></a>: Metropolis-Hastings sampling using the preconditioned  Crank-Nicholson algorithm, which has a well-behaved small-stepsize limit.</li><li><a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.BarkerSampling"><code>BarkerSampling</code></a>: Metropolis-Hastings sampling using the Barker proposal, which has a robustness to choosing step-size parameters.</li></ul></li><li><p><code>obs_sample</code>: Vector (for one sample) or matrix with columns as samples from the observation. Can, e.g., be picked from an Observation struct using <code>get_obs_sample</code>.</p></li><li><p><code>prior</code>: <a href="https://clima.github.io/EnsembleKalmanProcesses.jl/dev/parameter_distributions/"><code>ParameterDistribution</code></a>  object containing the parameters&#39; prior distributions.</p></li><li><p><code>emulator</code>: <a href="../Emulators/#CalibrateEmulateSample.Emulators.Emulator"><code>Emulator</code></a> to sample from.</p></li><li><p><code>stepsize</code>: MCMC step size, applied as a scaling to the prior covariance.</p></li><li><p><code>init_params</code>: Starting parameter values for MCMC sampling.</p></li><li><p><code>burnin</code>: Initial number of MCMC steps to discard from output (pre-convergence).</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L513">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StatsBase.sample" href="#StatsBase.sample"><code>StatsBase.sample</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>sample([rng,] mcmc::MCMCWrapper, args...; kwargs...)</p><p>Extends the <code>sample</code> methods of AbstractMCMC (which extends StatsBase) to sample from the  emulated posterior, using the MCMC sampling algorithm and <a href="../Emulators/#CalibrateEmulateSample.Emulators.Emulator"><code>Emulator</code></a> configured in  <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper"><code>MCMCWrapper</code></a>. Returns a <a href="https://beta.turing.ml/MCMCChains.jl/dev/"><code>MCMCChains.Chains</code></a>  object containing the samples. </p><p>Supported methods are:</p><ul><li><p><code>sample([rng, ]mcmc, N; kwargs...)</code></p><p>Return a <code>MCMCChains.Chains</code> object containing <code>N</code> samples from the emulated posterior.</p></li><li><p><code>sample([rng, ]mcmc, isdone; kwargs...)</code></p><p>Sample from the <code>model</code> with the Markov chain Monte Carlo <code>sampler</code> until a convergence  criterion <code>isdone</code> returns <code>true</code>, and return the samples. The function <code>isdone</code> has the  signature</p><pre><code class="language-julia hljs">    isdone(rng, model, sampler, samples, state, iteration; kwargs...)</code></pre><p>where <code>state</code> and <code>iteration</code> are the current state and iteration of the sampler,  respectively. It should return <code>true</code> when sampling should end, and <code>false</code> otherwise.</p></li><li><p><code>sample([rng, ]mcmc, parallel_type, N, nchains; kwargs...)</code></p><p>Sample <code>nchains</code> Monte Carlo Markov chains in parallel according to <code>parallel_type</code>, which may be <code>MCMCThreads()</code> or <code>MCMCDistributed()</code> for thread and parallel sampling,  respectively.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L583-L615">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.get_posterior" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.get_posterior"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.get_posterior</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_posterior(
    mcmc::CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper,
    chain::MCMCChains.Chains
) -&gt; EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution
</code></pre><p>Returns a <code>ParameterDistribution</code> object corresponding to the empirical distribution of the  samples in <code>chain</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This method does not currently support combining samples from multiple <code>Chains</code>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L721">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.optimize_stepsize" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.optimize_stepsize"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.optimize_stepsize</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">optimize_stepsize(
    rng::Random.AbstractRNG,
    mcmc::CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper;
    init_stepsize,
    N,
    max_iter,
    target_acc,
    sample_kwargs...
) -&gt; Float64
</code></pre><p>Uses a heuristic to return a stepsize for the <code>mh_proposal_sampler</code> element of  <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCWrapper"><code>MCMCWrapper</code></a> which yields fast convergence of the Markov chain.</p><p>The criterion used is that Metropolis-Hastings proposals should be accepted between 15% and  35% of the time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L658">source</a></section></article><p>See <a href="../../sample/#AbstractMCMC-sampling-API">AbstractMCMC sampling API</a> for background on our use of Turing.jl&#39;s  <a href="https://turing.ml/dev/docs/for-developers/interface">AbstractMCMC</a> API for  MCMC sampling.</p><h2 id="Sampler-algorithms"><a class="docs-heading-anchor" href="#Sampler-algorithms">Sampler algorithms</a><a id="Sampler-algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Sampler-algorithms" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type MCMCProtocol</code></pre><p>Type used to dispatch different methods of the <a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MetropolisHastingsSampler"><code>MetropolisHastingsSampler</code></a>  constructor, corresponding to different sampling algorithms.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L89">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type AutodiffProtocol</code></pre><p>Type used to dispatch different autodifferentiation methods where different emulators have a different compatability with autodiff packages </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L49">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.ForwardDiffProtocol" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.ForwardDiffProtocol"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.ForwardDiffProtocol</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type ForwardDiffProtocol &lt;: CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol</code></pre><p>Type to construct samplers for emulators compatible with <code>ForwardDiff.jl</code> autodifferentiation</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L63">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.ReverseDiffProtocol" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.ReverseDiffProtocol"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.ReverseDiffProtocol</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type ReverseDiffProtocol &lt;: CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol</code></pre><p>Type to construct samplers for emulators compatible with <code>ReverseDiff.jl</code> autodifferentiation</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L70">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.RWMHSampling" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.RWMHSampling"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.RWMHSampling</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct RWMHSampling{T&lt;:CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol} &lt;: CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol</code></pre><p><a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol"><code>MCMCProtocol</code></a> which uses Metropolis-Hastings sampling that generates proposals for  new parameters as as vanilla random walk, based on the covariance of <code>prior</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L97">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.pCNMHSampling" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.pCNMHSampling"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.pCNMHSampling</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct pCNMHSampling{T&lt;:CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol} &lt;: CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol</code></pre><p><a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol"><code>MCMCProtocol</code></a> which uses Metropolis-Hastings sampling that generates proposals for  new parameters according to the preconditioned Crank-Nicholson (pCN) algorithm, which is  usable for MCMC in the <em>stepsize → 0</em> limit, unlike the vanilla random walk. Steps are based  on the covariance of <code>prior</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L137">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.BarkerSampling" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.BarkerSampling"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.BarkerSampling</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct BarkerSampling{T&lt;:CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol} &lt;: CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol</code></pre><p><a href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCProtocol"><code>MCMCProtocol</code></a> which uses Metropolis-Hastings sampling that generates proposals for new parameters according to the Barker proposal.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L164">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.MetropolisHastingsSampler" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MetropolisHastingsSampler"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.MetropolisHastingsSampler</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MetropolisHastingsSampler(
    _::CalibrateEmulateSample.MarkovChainMonteCarlo.RWMHSampling{T&lt;:CalibrateEmulateSample.MarkovChainMonteCarlo.AutodiffProtocol},
    prior::EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution
) -&gt; CalibrateEmulateSample.MarkovChainMonteCarlo.RWMetropolisHastings{AdvancedMH.RandomWalkProposal{false, _A}} where _A
</code></pre><p>Constructor for all <code>Sampler</code> objects, with one method for each supported MCMC algorithm.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Both currently implemented Samplers use a Gaussian approximation to the prior:  specifically, new Metropolis-Hastings proposals are a scaled combination of the old  parameter values and a random shift distributed as a Gaussian with the same covariance as the <code>prior</code>. </p><p>This suffices for our current use case, in which our priors are Gaussian (possibly in a transformed space) and we assume enough fidelity in the Emulator that  inference isn&#39;t prior-dominated.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L117">source</a></section></article><h2 id="Emulated-posterior-(Model)"><a class="docs-heading-anchor" href="#Emulated-posterior-(Model)">Emulated posterior (Model)</a><a id="Emulated-posterior-(Model)-1"></a><a class="docs-heading-anchor-permalink" href="#Emulated-posterior-(Model)" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.EmulatorPosteriorModel" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.EmulatorPosteriorModel"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.EmulatorPosteriorModel</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">EmulatorPosteriorModel(
    prior::EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution,
    em::CalibrateEmulateSample.Emulators.Emulator{FT&lt;:AbstractFloat},
    obs_vec::AbstractVector
) -&gt; AdvancedMH.DensityModel{F} where F&lt;:(CalibrateEmulateSample.MarkovChainMonteCarlo.var&quot;#13#14&quot;{EnsembleKalmanProcesses.ParameterDistributions.ParameterDistribution{PDType, CType, ST}, CalibrateEmulateSample.Emulators.Emulator{FT, VV}, &lt;:AbstractVector{T}} where {PDType&lt;:EnsembleKalmanProcesses.ParameterDistributions.ParameterDistributionType, CType&lt;:EnsembleKalmanProcesses.ParameterDistributions.ConstraintType, ST&lt;:AbstractString, FT&lt;:AbstractFloat, VV&lt;:(AbstractVector), T})
</code></pre><p>Factory which constructs <code>AdvancedMH.DensityModel</code> objects given a prior on the model  parameters (<code>prior</code>) and an <a href="../Emulators/#CalibrateEmulateSample.Emulators.Emulator"><code>Emulator</code></a> of the log-likelihood of the data given  parameters. Together these yield the log posterior density we&#39;re attempting to sample from  with the MCMC, which is the role of the <code>DensityModel</code> class in the <code>AbstractMCMC</code> interface.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L264">source</a></section></article><h2 id="Internals-MCMC-State"><a class="docs-heading-anchor" href="#Internals-MCMC-State">Internals - MCMC State</a><a id="Internals-MCMC-State-1"></a><a class="docs-heading-anchor-permalink" href="#Internals-MCMC-State" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCState" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCState"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.MCMCState</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct MCMCState{T, L&lt;:Real} &lt;: AdvancedMH.AbstractTransition</code></pre><p>Extends the <code>AdvancedMH.Transition</code> (which encodes the current state of the MC during sampling) with a boolean flag to record whether this state is new (arising from accepting a Metropolis-Hastings proposal) or old (from rejecting a proposal).</p><p><strong>Fields</strong></p><ul><li><p><code>params::Any</code>: Sampled value of the parameters at the current state of the MCMC chain.</p></li><li><p><code>log_density::Real</code>: Log probability of <code>params</code>, as computed by the model using the prior.</p></li><li><p><code>accepted::Bool</code>: Whether this state resulted from accepting a new MH proposal.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L284">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CalibrateEmulateSample.MarkovChainMonteCarlo.accept_ratio" href="#CalibrateEmulateSample.MarkovChainMonteCarlo.accept_ratio"><code>CalibrateEmulateSample.MarkovChainMonteCarlo.accept_ratio</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">accept_ratio(chain::MCMCChains.Chains) -&gt; Any
</code></pre><p>Fraction of MC proposals in <code>chain</code> which were accepted (according to Metropolis-Hastings.)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CalibrateEmulateSample.jl/blob/14e03abcff1f3cbc90eb50a81c563282a894045f/src/MarkovChainMonteCarlo.jl#L627">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../RandomFeatures/">« Random Features</a><a class="docs-footer-nextpage" href="../Utilities/">Utilities »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 25 August 2025 20:20">Monday 25 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
